generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Vision Form Applications (from apply.wavelaunch.org)
model Application {
  id                     String    @id @default(cuid())
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  fullName               String
  email                  String
  instagramHandle        String?
  tiktokHandle           String?
  country                String
  industryNiche          String
  age                    Int
  professionalMilestones String
  personalTurningPoints  String
  visionForVenture       String
  hopeToAchieve          String
  targetAudience         String
  demographicProfile     String
  targetDemographicAge   String
  audienceGenderSplit    String
  audienceMaritalStatus  String
  currentChannels        String
  keyPainPoints          String
  brandValues            String
  differentiation        String
  uniqueValueProps       String
  emergingCompetitors    String
  idealBrandImage        String
  inspirationBrands      String?
  brandingAesthetics     String
  emotionsBrandEvokes    String
  brandPersonality       String
  preferredFont          String
  productCategories      String
  otherProductIdeas      String?
  scalingGoals           String
  growthStrategies       String
  longTermVision         String
  specificDeadlines      String?
  additionalInfo         String?
  zipFilePath            String?
  zipFileName            String?
  zipFileSize            Int?
  termsAccepted          Boolean   @default(false)
  status                 String    @default("PENDING")
  reviewedAt             DateTime?
  reviewNotes            String?
  convertedToClientId    String?

  @@index([email])
  @@index([createdAt])
  @@index([status])
}

// Mission Control tables (for future integration)
model MCEmailReply {
  id               String                 @id @default(cuid())
  instantlyEmailId String                 @unique
  senderEmail      String
  senderName       String?
  classification   MCEmailClassification?
  intent           String?
  confidence       Float?
  reasoning        String?
  subject          String
  bodyText         String
  bodyHtml         String?
  draftResponse    String?
  draftStatus      String                 @default("pending")
  sentAt           DateTime?
  applicationId    String?
  creatorId        String?
  receivedAt       DateTime               @default(now())
  processedAt      DateTime?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  processingStatus String                 @default("pending")
  eaccount         String?
  creator          MCCreator?             @relation(fields: [creatorId], references: [id])

  @@index([classification])
  @@index([draftStatus])
  @@index([processingStatus])
  @@index([receivedAt])
  @@index([creatorId])
  @@map("mc_email_replies")
}

model MCCreator {
  id                String         @id @default(cuid())
  applicationId     String         @unique
  stage             MCCreatorStage @default(INTERESTED)
  blueprintStatus   String         @default("not_started")
  blueprintProgress Float          @default(0)
  blueprintMdPath   String?
  blueprintPdfPath  String?
  brandName         String?
  brandStage        Int?
  brandRevenue      Float?
  brandMargin       Float?
  brandCAC_LTV      String?
  brandStatus       String?
  brandRiskCount    Int            @default(0)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  notes             String?
  blueprint         MCBlueprint?
  emails            MCEmailReply[]

  @@index([stage])
  @@index([applicationId])
  @@map("mc_creators")
}

model MCBlueprint {
  id           String               @id @default(cuid())
  creatorId    String               @unique
  status       String               @default("pending")
  currentStage String?
  currentBatch Int                  @default(1)
  progress     Float                @default(0)
  model        String               @default("glm-4.7-flash")
  startedAt    DateTime?
  completedAt  DateTime?
  totalTokens  Int                  @default(0)
  errorMessage String?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  sections     MCBlueprintSection[]
  creator      MCCreator            @relation(fields: [creatorId], references: [id])

  @@index([status])
  @@map("mc_blueprints")
}

model MCBlueprintSection {
  id          String           @id @default(cuid())
  blueprintId String
  stage       MCBlueprintStage
  batch       Int
  status      String           @default("pending")
  content     String?
  tokensUsed  Int              @default(0)
  startedAt   DateTime?
  completedAt DateTime?
  error       String?
  attempts    Int              @default(0)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  edited      Boolean          @default(false)
  blueprint   MCBlueprint      @relation(fields: [blueprintId], references: [id], onDelete: Cascade)

  @@index([blueprintId, stage])
  @@index([status])
  @@map("mc_blueprint_sections")
}

model MCDailyAction {
  id          String    @id @default(cuid())
  type        String
  title       String
  description String?
  priority    String    @default("medium")
  relatedId   String?
  relatedType String?
  status      String    @default("pending")
  completedAt DateTime?
  dueDate     DateTime?
  actionDate  DateTime  @default(now())
  createdAt   DateTime  @default(now())

  @@index([status])
  @@index([actionDate])
  @@index([type])
  @@map("mc_daily_actions")
}

model MCInstantlySync {
  id              String   @id @default(cuid())
  lastSyncAt      DateTime @default(now())
  lastEmailId     String?
  emailsProcessed Int      @default(0)
  status          String   @default("idle")
  error           String?
  monitoringFrom  DateTime @default(now())

  @@map("mc_instantly_sync")
}

model MCSystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt

  @@map("mc_system_config")
}

enum MCBlueprintStage {
  EXECUTIVE_SUMMARY
  CREATOR_VISION_INTENT
  FOUR_PILLARS_EVALUATION
  CREATOR_BRAND_ASSESSMENT
  MARKET_WHITESPACE
  COMPETITIVE_INTELLIGENCE
  INDUSTRY_TRENDS
  BUSINESS_DIRECTION_OPTIONS
  GO_TO_MARKET_STRATEGY
  OPERATIONAL_FRAMEWORK
  IMPLEMENTATION_ROADMAP
  REVENUE_ECONOMICS
  SUCCESS_METRICS_KPI
  ASSUMPTIONS_RISKS
  FINAL_RECOMMENDATION
  COMPILATION
}

enum MCCreatorStage {
  INTERESTED
  VISION_FORM_SENT
  VISION_FORM_COMPLETE
  BLUEPRINT_BUILDING
  BLUEPRINT_SENT
  COMMITTED
  ACTIVE
  STALLED
  CLOSED
}

enum MCEmailClassification {
  QUALIFIED
  MISFIT
  CLARIFICATION
  EDGE
}
